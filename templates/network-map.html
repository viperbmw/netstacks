{% extends "base.html" %}

{% block title %}Network Map - NetStacks{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="mb-4">
            <i class="fas fa-project-diagram"></i> Network Map
        </h1>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-sliders-h"></i> Visualization Controls</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Layout</label>
                        <select id="layout-select" class="form-select form-select-sm">
                            <option value="physics">Physics (Auto-arrange)</option>
                            <option value="hierarchical">Hierarchical</option>
                            <option value="random">Random</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Node Size</label>
                        <input type="range" id="node-size-slider" class="form-range" min="10" max="50" value="25">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Actions</label>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-primary" id="refresh-btn" title="Reload devices (uses cache if available)">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-outline-secondary" id="fit-btn" title="Fit all nodes in view">
                                <i class="fas fa-expand"></i> Fit View
                            </button>
                        </div>
                        <div class="form-text small mt-1">
                            <i class="fas fa-info-circle"></i> Cache: 5 min
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Filter</label>
                        <input type="text" id="filter-input" class="form-control form-control-sm" placeholder="Filter devices...">
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-12">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="show-labels" checked>
                            <label class="form-check-label" for="show-labels">Show Labels</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="physics-enabled" checked>
                            <label class="form-check-label" for="physics-enabled">Enable Physics</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="show-manual-devices" checked>
                            <label class="form-check-label" for="show-manual-devices">Show Manual Devices</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="show-netbox-devices" checked>
                            <label class="form-check-label" for="show-netbox-devices">Show NetBox Devices</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-9">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="fas fa-network-wired"></i> Network Topology</h5>
                <div>
                    <span class="badge bg-info me-2" id="cache-status-badge" style="display:none;">
                        <i class="fas fa-clock"></i> Cached
                    </span>
                    <span class="badge bg-secondary" id="device-count-badge">0 devices</span>
                </div>
            </div>
            <div class="card-body p-0">
                <div id="network-container" style="height: 700px; background: linear-gradient(to right, #3a3a3a 1px, transparent 1px), linear-gradient(to bottom, #3a3a3a 1px, transparent 1px), #2b2b2b; background-size: 20px 20px;">
                    <div class="text-center pt-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading network...</span>
                        </div>
                        <p class="mt-2">Loading network topology...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Device Info</h5>
            </div>
            <div class="card-body" id="device-info-panel">
                <p class="text-muted text-center">Click a device to view details</p>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-palette"></i> Legend</h5>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <span class="badge" style="background-color: #4A90E2; color: white;">
                        <i class="fas fa-circle"></i>
                    </span> Cisco IOS/IOS-XE
                </div>
                <div class="mb-2">
                    <span class="badge" style="background-color: #50C878; color: white;">
                        <i class="fas fa-circle"></i>
                    </span> Cisco NX-OS
                </div>
                <div class="mb-2">
                    <span class="badge" style="background-color: #FF6B6B; color: white;">
                        <i class="fas fa-circle"></i>
                    </span> Arista EOS
                </div>
                <div class="mb-2">
                    <span class="badge" style="background-color: #9B59B6; color: white;">
                        <i class="fas fa-circle"></i>
                    </span> Juniper Junos
                </div>
                <div class="mb-2">
                    <span class="badge" style="background-color: #F39C12; color: white;">
                        <i class="fas fa-circle"></i>
                    </span> Linux
                </div>
                <div class="mb-2">
                    <span class="badge" style="background-color: #95A5A6; color: white;">
                        <i class="fas fa-circle"></i>
                    </span> Other
                </div>
                <hr>
                <div class="mb-2">
                    <i class="fas fa-server" style="color: #666;"></i> NetBox Device
                </div>
                <div class="mb-2">
                    <i class="fas fa-laptop" style="color: #666;"></i> Manual Device
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Connection Modal (for adding connections) -->
<div class="modal fade" id="addConnectionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-link"></i> Add Connection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Future feature: Define connections between devices (LLDP/CDP discovery or manual)</p>
                <form id="add-connection-form">
                    <div class="mb-3">
                        <label for="connection-from" class="form-label">From Device</label>
                        <select class="form-select" id="connection-from">
                            <option value="">Select device...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="connection-to" class="form-label">To Device</label>
                        <select class="form-select" id="connection-to">
                            <option value="">Select device...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="connection-type" class="form-label">Connection Type</label>
                        <select class="form-select" id="connection-type">
                            <option value="ethernet">Ethernet</option>
                            <option value="fiber">Fiber</option>
                            <option value="wireless">Wireless</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-connection-btn">Save Connection</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Vis.js Network -->
<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<script src="{{ url_for('static', filename='js/network-map.js') }}"></script>
{% endblock %}
